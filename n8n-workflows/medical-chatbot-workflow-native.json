{
  "name": "Medical Chatbot - Vietnamese Native",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "medical-chat",
        "responseMode": "onReceived",
        "options": {}
      },
      "id": "webhook-1",
      "name": "Webhook - Chat Input",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "medical-chat-webhook"
    },
    {
      "parameters": {
        "jsCode": "const message = $input.first().json.message?.toLowerCase() || '';\nconst userId = $input.first().json.userId || 'anonymous';\nconst sessionId = $input.first().json.sessionId || Date.now().toString();\n\nconst symptomKeywords = {\n  'Ä‘au_Ä‘áº§u': ['Ä‘au Ä‘áº§u', 'nhá»©c Ä‘áº§u', 'migraine', 'headache', 'Ä‘au ná»­a Ä‘áº§u'],\n  'sá»‘t': ['sá»‘t', 'fever', 'nÃ³ng ngÆ°á»i', 'á»‘m', 'bá»‹ sá»‘t'],\n  'ho': ['ho', 'cough', 'ho khan', 'ho cÃ³ Ä‘á»m', 'ho nhiá»u'],\n  'Ä‘au_bá»¥ng': ['Ä‘au bá»¥ng', 'stomach pain', 'Ä‘au dáº¡ dÃ y', 'Ä‘au tá»¥t'],\n  'cáº£m_láº¡nh': ['cáº£m láº¡nh', 'cold', 'flu', 'cÃºm', 'ngháº¹t mÅ©i'],\n  'má»¥n_trá»©ng_cÃ¡': ['má»¥n', 'acne', 'má»¥n trá»©ng cÃ¡', 'da má»¥n', 'má»¥n má»§'],\n  'tiÃªu_cháº£y': ['tiÃªu cháº£y', 'diarrhea', 'Ä‘i lá»ng', 'Ä‘i nÆ°á»›c'],\n  'tÃ¡o_bÃ³n': ['tÃ¡o bÃ³n', 'constipation', 'khÃ³ Ä‘i Ä‘áº¡i tiá»‡n'],\n  'viÃªm_há»ng': ['viÃªm há»ng', 'sore throat', 'Ä‘au há»ng', 'há»ng Ä‘au'],\n  'chÃ³ng_máº·t': ['chÃ³ng máº·t', 'dizzy', 'hoa máº¯t', 'Ä‘áº§u quay']\n};\n\nlet detectedSymptoms = [];\nfor (let symptom in symptomKeywords) {\n  for (let keyword of symptomKeywords[symptom]) {\n    if (message.includes(keyword)) {\n      detectedSymptoms.push(symptom);\n      break;\n    }\n  }\n}\n\nlet severity = 'mild';\nif (message.includes('ráº¥t') || message.includes('nhiá»u') || message.includes('náº·ng')) {\n  severity = 'severe';\n} else if (message.includes('hÆ¡i') || message.includes('nháº¹')) {\n  severity = 'mild';\n} else {\n  severity = 'moderate';\n}\n\ndetectedSymptoms = [...new Set(detectedSymptoms)];\n\nreturn {\n  json: {\n    originalMessage: $input.first().json.message,\n    detectedSymptoms: detectedSymptoms,\n    severity: severity,\n    userId: userId,\n    sessionId: sessionId,\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "code-symptom-detection",
      "name": "Symptom Detection",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "jsCode": "const medicalDataSample = [\n  {\n    \"drug_name\": \"Paracetamol\",\n    \"medical_condition\": \"Pain\",\n    \"medical_condition_vi\": \"Ä‘au Ä‘áº§u\",\n    \"side_effects_vi\": \"buá»“n nÃ´n, chÃ³ng máº·t\",\n    \"drug_classes_vi\": \"thuá»‘c giáº£m Ä‘au\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 8.5\n  },\n  {\n    \"drug_name\": \"Aspirin\",\n    \"medical_condition\": \"Headache\", \n    \"medical_condition_vi\": \"Ä‘au Ä‘áº§u\",\n    \"side_effects_vi\": \"Ä‘au dáº¡ dÃ y\",\n    \"drug_classes_vi\": \"thuá»‘c chá»‘ng viÃªm\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 7.8\n  },\n  {\n    \"drug_name\": \"Ibuprofen\",\n    \"medical_condition\": \"Pain\",\n    \"medical_condition_vi\": \"Ä‘au Ä‘áº§u\",\n    \"side_effects_vi\": \"buá»“n nÃ´n\",\n    \"drug_classes_vi\": \"thuá»‘c giáº£m Ä‘au\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 8.2\n  },\n  {\n    \"drug_name\": \"Cough Syrup\",\n    \"medical_condition\": \"Cough\",\n    \"medical_condition_vi\": \"ho\",\n    \"side_effects_vi\": \"buá»“n ngá»§\",\n    \"drug_classes_vi\": \"thuá»‘c ho\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 7.5\n  },\n  {\n    \"drug_name\": \"Fever Reducer\",\n    \"medical_condition\": \"Fever\",\n    \"medical_condition_vi\": \"sá»‘t\",\n    \"side_effects_vi\": \"chÃ³ng máº·t\",\n    \"drug_classes_vi\": \"thuá»‘c háº¡ sá»‘t\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 8.0\n  },\n  {\n    \"drug_name\": \"Antacid\",\n    \"medical_condition\": \"Stomach Pain\",\n    \"medical_condition_vi\": \"Ä‘au bá»¥ng\",\n    \"side_effects_vi\": \"tÃ¡o bÃ³n\",\n    \"drug_classes_vi\": \"thuá»‘c dáº¡ dÃ y\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 7.3\n  }\n];\n\nconst symptoms = $input.first().json.detectedSymptoms;\nconst severity = $input.first().json.severity;\n\nconst medicalData = medicalDataSample;\nlet foundDrugs = [];\n\nfor (let symptom of symptoms) {\n  const symptomSearch = symptom.replace('_', ' ');\n  \n  const matchingDrugs = medicalData.filter(drug => {\n    const condition = (drug.medical_condition_vi || '').toLowerCase();\n    const conditionEn = (drug.medical_condition || '').toLowerCase();\n    \n    return condition.includes(symptomSearch) || \n           conditionEn.includes(symptomSearch) ||\n           condition.includes(symptom.replace('_', ''));\n  });\n  \n  foundDrugs.push(...matchingDrugs);\n}\n\nfoundDrugs.sort((a, b) => {\n  if (severity === 'mild') {\n    if (a.rx_otc === 'OTC' && b.rx_otc !== 'OTC') return -1;\n    if (b.rx_otc === 'OTC' && a.rx_otc !== 'OTC') return 1;\n  }\n  return (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0);\n});\n\nconst uniqueDrugs = foundDrugs.filter((drug, index, self) => \n  index === self.findIndex(d => d.drug_name === drug.drug_name)\n);\n\nreturn {\n  json: {\n    symptoms: symptoms,\n    severity: severity,\n    recommendedDrugs: uniqueDrugs.slice(0, 5),\n    totalFound: uniqueDrugs.length,\n    userId: $input.first().json.userId,\n    sessionId: $input.first().json.sessionId,\n    searchTimestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "code-drug-search",
      "name": "Drug Search Engine",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "jsCode": "const symptoms = $input.first().json.symptoms || [];\nconst drugs = $input.first().json.recommendedDrugs || [];\nconst severity = $input.first().json.severity;\nconst originalMessage = $input.first().json.originalMessage || '';\n\nlet response = \"\";\nlet responseType = \"\";\n\nif (symptoms.length === 0) {\n  responseType = \"no_symptoms\";\n  response = `Xin chÃ o! TÃ´i khÃ´ng thá»ƒ xÃ¡c Ä‘á»‹nh triá»‡u chá»©ng cá»¥ thá»ƒ tá»« tin nháº¯n: \"${originalMessage}\".\\n\\n`;\n  response += `Báº¡n cÃ³ thá»ƒ mÃ´ táº£ rÃµ hÆ¡n triá»‡u chá»©ng cá»§a mÃ¬nh khÃ´ng? VÃ­ dá»¥:\\n`;\n  response += `â€¢ \"TÃ´i bá»‹ Ä‘au Ä‘áº§u\"\\n`;\n  response += `â€¢ \"TÃ´i bá»‹ sá»‘t vÃ  ho\"\\n`;\n  response += `â€¢ \"TÃ´i bá»‹ Ä‘au bá»¥ng\"\\n\\n`;\n  response += `TÃ´i cÃ³ thá»ƒ giÃºp tÆ° váº¥n thuá»‘c cho cÃ¡c triá»‡u chá»©ng phá»• biáº¿n! ğŸ˜Š`;\n} else if (drugs.length === 0) {\n  responseType = \"no_drugs\";\n  const symptomText = symptoms.map(s => s.replace(/_/g, ' ')).join(', ');\n  response = `TÃ´i Ä‘Ã£ hiá»ƒu báº¡n cÃ³ triá»‡u chá»©ng: **${symptomText}**.\\n\\n`;\n  response += `Tuy nhiÃªn, tÃ´i khÃ´ng tÃ¬m tháº¥y thuá»‘c phÃ¹ há»£p trong cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n táº¡i.\\n\\n`;\n  response += `ğŸ¥ **Gá»£i Ã½:**\\n`;\n  response += `â€¢ ThÄƒm khÃ¡m bÃ¡c sÄ© Ä‘á»ƒ Ä‘Æ°á»£c tÆ° váº¥n chÃ­nh xÃ¡c\\n`;\n  response += `â€¢ LiÃªn há»‡ dÆ°á»£c sÄ© táº¡i nhÃ  thuá»‘c gáº§n nháº¥t\\n`;\n  response += `â€¢ Gá»i hotline y táº¿: 19003116`;\n} else {\n  responseType = \"recommendations\";\n  const symptomText = symptoms.map(s => s.replace(/_/g, ' ')).join(', ');\n  const severityText = severity === 'mild' ? 'nháº¹' : severity === 'severe' ? 'náº·ng' : 'vá»«a pháº£i';\n  \n  response = `Dá»±a trÃªn triá»‡u chá»©ng **\"${symptomText}\"** (má»©c Ä‘á»™: ${severityText}), tÃ´i gá»£i Ã½ cÃ¡c thuá»‘c sau:\\n\\n`;\n  \n  drugs.forEach((drug, index) => {\n    response += `**${index + 1}. ${drug.drug_name}** `;\n    response += `${drug.rx_otc === 'OTC' ? 'ğŸŸ¢' : 'ğŸ”´'} ${drug.rx_otc}\\n`;\n    \n    if (drug.medical_condition_vi) {\n      response += `   ğŸ“‹ DÃ¹ng cho: ${drug.medical_condition_vi}\\n`;\n    }\n    \n    if (drug.drug_classes_vi) {\n      response += `   ğŸ’Š Loáº¡i thuá»‘c: ${drug.drug_classes_vi}\\n`;\n    }\n    \n    if (drug.rating) {\n      const stars = 'â­'.repeat(Math.round(parseFloat(drug.rating) / 2));\n      response += `   ${stars} ÄÃ¡nh giÃ¡: ${drug.rating}/10\\n`;\n    }\n    \n    if (drug.side_effects_vi) {\n      response += `   âš ï¸ TÃ¡c dá»¥ng phá»¥: ${drug.side_effects_vi}\\n`;\n    }\n    \n    response += `\\n`;\n  });\n  \n  response += `\\nğŸ›¡ï¸ **LÆ°U Ã QUAN TRá»ŒNG:**\\n`;\n  response += `â€¢ ğŸŸ¢ OTC: KhÃ´ng cáº§n toa bÃ¡c sÄ©\\n`;\n  response += `â€¢ ğŸ”´ Rx: Cáº§n cÃ³ toa bÃ¡c sÄ©\\n`;\n  response += `â€¢ ThÃ´ng tin nÃ y chá»‰ mang tÃ­nh cháº¥t tham kháº£o\\n`;\n  response += `â€¢ Tham kháº£o Ã½ kiáº¿n bÃ¡c sÄ©/dÆ°á»£c sÄ© trÆ°á»›c khi sá»­ dá»¥ng\\n`;\n  response += `â€¢ Äá»c ká»¹ hÆ°á»›ng dáº«n sá»­ dá»¥ng\\n`;\n  response += `â€¢ NgÆ°ng sá»­ dá»¥ng náº¿u cÃ³ pháº£n á»©ng báº¥t thÆ°á»ng\\n\\n`;\n  \n  if (severity === 'severe') {\n    response += `ğŸš¨ **Cáº¢NH BÃO**: Triá»‡u chá»©ng náº·ng - NÃªn thÄƒm khÃ¡m bÃ¡c sÄ© ngay!`;\n  }\n}\n\nreturn {\n  json: {\n    response: response,\n    responseType: responseType,\n    metadata: {\n      symptoms: symptoms,\n      symptomsCount: symptoms.length,\n      drugsFound: drugs.length,\n      severity: severity,\n      originalMessage: originalMessage,\n      timestamp: new Date().toISOString(),\n      language: 'vi'\n    },\n    userId: $input.first().json.userId,\n    sessionId: $input.first().json.sessionId\n  }\n};"
      },
      "id": "code-response-generator", 
      "name": "Response Generator",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{{ $json }}"
      },
      "id": "webhook-response",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.webhookResponse",
      "typeVersion": 1,
      "position": [1120, 300]
    }
  ],
  "connections": {
    "Webhook - Chat Input": {
      "main": [
        [
          {
            "node": "Symptom Detection",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Symptom Detection": {
      "main": [
        [
          {
            "node": "Drug Search Engine",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Drug Search Engine": {
      "main": [
        [
          {
            "node": "Response Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Response Generator": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-10-10T10:00:00.000Z",
      "updatedAt": "2025-10-10T10:00:00.000Z",
      "id": "1",
      "name": "medical"
    },
    {
      "createdAt": "2025-10-10T10:00:00.000Z",
      "updatedAt": "2025-10-10T10:00:00.000Z",
      "id": "2",
      "name": "vietnamese"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-10-10T10:00:00.000Z",
  "versionId": "v3-medical-vietnamese-native"
}