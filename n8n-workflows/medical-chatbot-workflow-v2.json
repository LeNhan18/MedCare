{
  "name": "Medical Chatbot Workflow - Vietnamese",
  "nodes": [
    {
      "parameters": {},
      "id": "0c6b1b2e-8f4c-4a1a-9b3d-2e5f6a7b8c9d",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [580, 300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "medical-chat",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "1d7c2c3f-9e5d-4b2b-ac4e-3f6e7b8c9d0e",
      "name": "Webhook Chat Input",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [580, 200],
      "webhookId": "medical-chatbot-webhook"
    },
    {
      "parameters": {
        "jsCode": "const userMessage = $input.all()[0].json.body?.message || $input.all()[0].json.message || 'TÃ´i cáº§n tÆ° váº¥n thuá»‘c';\nconst userId = $input.all()[0].json.body?.userId || $input.all()[0].json.userId || 'user_001';\nconst sessionId = $input.all()[0].json.body?.sessionId || Date.now().toString();\n\nconst cleanMessage = userMessage.toLowerCase().replace(/[^\\wÃ Ã¡áº¡áº£Ã£Ã¢áº§áº¥áº­áº©áº«Äƒáº±áº¯áº·áº³áºµÃ¨Ã©áº¹áº»áº½Ãªá»áº¿á»‡á»ƒá»…Ã¬Ã­á»‹á»‰Ä©Ã²Ã³á»á»ÃµÃ´á»“á»‘á»™á»•á»—Æ¡á»á»›á»£á»Ÿá»¡Ã¹Ãºá»¥á»§Å©Æ°á»«á»©á»±á»­á»¯á»³Ã½á»µá»·á»¹Ä‘\\s]/gi, '').trim();\n\nlet intent = 'general_inquiry';\nlet symptoms = [];\nlet severity = 'mild';\n\nconst symptomKeywords = {\n  'Ä‘au_Ä‘áº§u': ['Ä‘au Ä‘áº§u', 'nhá»©c Ä‘áº§u', 'Ä‘au ná»­a Ä‘áº§u', 'migraine', 'headache'],\n  'sá»‘t': ['sá»‘t', 'nÃ³ng sá»‘t', 'fever', 'bá»‘c há»a'],\n  'ho': ['ho', 'cough', 'ho khan', 'ho cÃ³ Ä‘á»m'],\n  'Ä‘au_bá»¥ng': ['Ä‘au bá»¥ng', 'Ä‘au dáº¡ dÃ y', 'stomach pain', 'Ä‘au tá»¥y'],\n  'má»¥n_trá»©ng_cÃ¡': ['má»¥n', 'má»¥n trá»©ng cÃ¡', 'acne', 'má»¥n Ä‘áº§u Ä‘en'],\n  'giáº£m_cÃ¢n': ['giáº£m cÃ¢n', 'bÃ©o phÃ¬', 'weight loss', 'diet', 'slim'],\n  'tiÃªu_cháº£y': ['tiÃªu cháº£y', 'diarrhea', 'Ä‘i ngoÃ i', 'lá»ng'],\n  'tÃ¡o_bÃ³n': ['tÃ¡o bÃ³n', 'constipation', 'khÃ³ Ä‘i ngoÃ i'],\n  'dá»‹_á»©ng': ['dá»‹ á»©ng', 'allergy', 'phÃ¡t ban', 'ngá»©a'],\n  'cáº£m_cÃºm': ['cáº£m cÃºm', 'cáº£m láº¡nh', 'flu', 'cold', 'ngháº¹t mÅ©i']\n};\n\nfor (const [symptom, keywords] of Object.entries(symptomKeywords)) {\n  for (const keyword of keywords) {\n    if (cleanMessage.includes(keyword)) {\n      symptoms.push(symptom);\n      intent = 'symptom_inquiry';\n      break;\n    }\n  }\n}\n\nif (cleanMessage.includes('ráº¥t Ä‘au') || cleanMessage.includes('severe') || cleanMessage.includes('dá»¯ dá»™i')) {\n  severity = 'severe';\n} else if (cleanMessage.includes('khÃ¡ Ä‘au') || cleanMessage.includes('moderate') || cleanMessage.includes('vá»«a')) {\n  severity = 'moderate';\n}\n\nif (cleanMessage.includes('tÃ¡c dá»¥ng phá»¥') || cleanMessage.includes('side effect')) {\n  intent = 'side_effects_inquiry';\n} else if (cleanMessage.includes('liá»u dÃ¹ng') || cleanMessage.includes('dosage') || cleanMessage.includes('cÃ¡ch uá»‘ng')) {\n  intent = 'dosage_inquiry';\n} else if (cleanMessage.includes('tÆ°Æ¡ng tÃ¡c thuá»‘c') || cleanMessage.includes('drug interaction')) {\n  intent = 'drug_interaction';\n}\n\nreturn {\n  json: {\n    userId: userId,\n    sessionId: sessionId,\n    originalMessage: userMessage,\n    cleanMessage: cleanMessage,\n    intent: intent,\n    symptoms: symptoms,\n    severity: severity,\n    timestamp: new Date().toISOString(),\n    language: 'vi'\n  }\n};"
      },
      "id": "2e8d3d4e-af6e-5c3c-bd5f-4e7f8c9d0e1f",
      "name": "Process User Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [820, 250]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "intent_symptom",
              "leftValue": "={{ $json.intent }}",
              "rightValue": "symptom_inquiry",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "3f9e4e5f-be7f-6d4d-ce6e-5f8e9d0e1f2e",
      "name": "Route by Intent",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1060, 250]
    },
    {
      "parameters": {
        "url": "http://localhost:3001/api/search-drugs",
        "sendQuery": false,
        "sendHeaders": false,
        "sendBody": true,
        "contentType": "json",
        "body": "={\n  \"symptoms\": {{ JSON.stringify($json.symptoms) }},\n  \"severity\": \"{{ $json.severity }}\",\n  \"language\": \"vi\"\n}",
        "options": {}
      },
      "id": "4e0f5f6e-cf8e-7e5e-df7f-6f9f0e1f2f3f",
      "name": "Search Medical Database",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1300, 150]
    },
    {
      "parameters": {
        "jsCode": "const searchResults = $input.all()[0].json;\nconst userData = $('Process User Input').all()[0].json;\n\nlet response = {\n  success: true,\n  userId: userData.userId,\n  sessionId: userData.sessionId,\n  intent: userData.intent,\n  recommendations: [],\n  message: '',\n  timestamp: new Date().toISOString()\n};\n\nif (searchResults.drugs && searchResults.drugs.length > 0) {\n  const topDrugs = searchResults.drugs.slice(0, 3);\n  \n  response.recommendations = topDrugs.map(drug => ({\n    drugName: drug.drug_name,\n    condition: drug.condition_vi || drug.medical_condition,\n    description: drug.description_vi ? drug.description_vi.substring(0, 200) + '...' : 'KhÃ´ng cÃ³ mÃ´ táº£ chi tiáº¿t',\n    drugClass: drug.drug_class_vi || drug.drug_classes,\n    rxOtc: drug.rx_otc,\n    rating: drug.rating,\n    sideEffects: drug.side_effects_vi ? drug.side_effects_vi.substring(0, 150) + '...' : 'Vui lÃ²ng tham kháº£o bÃ¡c sÄ© vá» tÃ¡c dá»¥ng phá»¥'\n  }));\n  \n  const symptomsText = userData.symptoms.join(', ').replace(/_/g, ' ');\n  response.message = `ğŸ¥ **TÆ° váº¥n y táº¿ cho triá»‡u chá»©ng: ${symptomsText}**\\n\\n` +\n    `Dá»±a trÃªn triá»‡u chá»©ng báº¡n mÃ´ táº£, tÃ´i gá»£i Ã½ ${topDrugs.length} loáº¡i thuá»‘c phÃ¹ há»£p:\\n\\n`;\n  \n  topDrugs.forEach((drug, index) => {\n    response.message += `**${index + 1}. ${drug.drug_name}** ${drug.rx_otc === 'OTC' ? '(KhÃ´ng cáº§n toa)' : '(Cáº§n toa bÃ¡c sÄ©)'}\\n`;\n    response.message += `ğŸ“‹ Äiá»u trá»‹: ${drug.condition_vi || drug.medical_condition}\\n`;\n    response.message += `â­ ÄÃ¡nh giÃ¡: ${drug.rating}/10\\n`;\n    response.message += `ğŸ’Š NhÃ³m thuá»‘c: ${drug.drug_class_vi || drug.drug_classes}\\n\\n`;\n  });\n  \n  response.message += `âš ï¸ **LÆ°u Ã½ quan trá»ng:**\\n` +\n    `â€¢ ÄÃ¢y chá»‰ lÃ  tÆ° váº¥n tham kháº£o\\n` +\n    `â€¢ Vui lÃ²ng tham kháº£o Ã½ kiáº¿n bÃ¡c sÄ© trÆ°á»›c khi sá»­ dá»¥ng\\n` +\n    `â€¢ Äá»c ká»¹ hÆ°á»›ng dáº«n sá»­ dá»¥ng trÃªn bao bÃ¬\\n` +\n    `â€¢ KhÃ´ng tá»± Ã½ tÄƒng giáº£m liá»u lÆ°á»£ng`;\n    \n} else {\n  response.success = false;\n  response.message = `â“ **KhÃ´ng tÃ¬m tháº¥y thuá»‘c phÃ¹ há»£p**\\n\\n` +\n    `Ráº¥t tiáº¿c, tÃ´i chÆ°a tÃ¬m Ä‘Æ°á»£c thuá»‘c phÃ¹ há»£p vá»›i triá»‡u chá»©ng \\\"${userData.originalMessage}\\\".\\n\\n` +\n    `ğŸ¥ **Gá»£i Ã½:**\\n` +\n    `â€¢ MÃ´ táº£ chi tiáº¿t hÆ¡n vá» triá»‡u chá»©ng\\n` +\n    `â€¢ ThÄƒm khÃ¡m trá»±c tiáº¿p táº¡i phÃ²ng khÃ¡m\\n` +\n    `â€¢ Gá»i hotline tÆ° váº¥n y táº¿: 19003456\\n\\n` +\n    `ğŸ’¬ **VÃ­ dá»¥ cÃ¢u há»i tá»‘t:**\\n` +\n    `\\\"TÃ´i bá»‹ Ä‘au Ä‘áº§u vÃ  sá»‘t nháº¹\\\"\\n` +\n    `\\\"Con tÃ´i bá»‹ ho khan tá»« 3 ngÃ y nay\\\"`;\n}\n\nreturn { json: response };"
      },
      "id": "5f1e6e7f-de9f-8f6f-ee8f-7e0e1f2f3e4f",
      "name": "Process Drug Recommendations",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1540, 150]
    },
    {
      "parameters": {
        "jsCode": "const userData = $('Process User Input').all()[0].json;\n\nlet response = {\n  success: true,\n  userId: userData.userId,\n  sessionId: userData.sessionId,\n  intent: userData.intent,\n  message: '',\n  timestamp: new Date().toISOString()\n};\n\nswitch(userData.intent) {\n  case 'side_effects_inquiry':\n    response.message = `ğŸ’Š **Há»i vá» tÃ¡c dá»¥ng phá»¥**\\n\\n` +\n      `Äá»ƒ tÆ° váº¥n vá» tÃ¡c dá»¥ng phá»¥, tÃ´i cáº§n biáº¿t tÃªn thuá»‘c cá»¥ thá»ƒ.\\n\\n` +\n      `ğŸ” **Vui lÃ²ng cung cáº¥p:**\\n` +\n      `â€¢ TÃªn thuá»‘c chÃ­nh xÃ¡c\\n` +\n      `â€¢ Triá»‡u chá»©ng báº¡n Ä‘ang gáº·p\\n` +\n      `â€¢ Thá»i gian sá»­ dá»¥ng thuá»‘c\\n\\n` +\n      `ğŸ’¬ **VÃ­ dá»¥:** \\\"Paracetamol cÃ³ tÃ¡c dá»¥ng phá»¥ gÃ¬?\\\"`;\n    break;\n    \n  case 'dosage_inquiry':\n    response.message = `ğŸ“‹ **Há»i vá» liá»u dÃ¹ng**\\n\\n` +\n      `Liá»u dÃ¹ng thuá»‘c phá»¥ thuá»™c vÃ o nhiá»u yáº¿u tá»‘:\\n\\n` +\n      `ğŸ‘¤ **ThÃ´ng tin cáº§n thiáº¿t:**\\n` +\n      `â€¢ Tuá»•i vÃ  cÃ¢n náº·ng\\n` +\n      `â€¢ TÃ¬nh tráº¡ng sá»©c khá»e hiá»‡n táº¡i\\n` +\n      `â€¢ CÃ¡c thuá»‘c Ä‘ang dÃ¹ng kÃ¨m\\n\\n` +\n      `âš ï¸ **Khuyáº¿n cÃ¡o:** LuÃ´n tuÃ¢n theo chá»‰ Ä‘á»‹nh cá»§a bÃ¡c sÄ© hoáº·c hÆ°á»›ng dáº«n trÃªn bao bÃ¬ thuá»‘c.`;\n    break;\n    \n  case 'drug_interaction':\n    response.message = `âš ï¸ **TÆ°Æ¡ng tÃ¡c thuá»‘c**\\n\\n` +\n      `TÆ°Æ¡ng tÃ¡c thuá»‘c cÃ³ thá»ƒ nguy hiá»ƒm. Cáº§n thÃ´ng tin chi tiáº¿t:\\n\\n` +\n      `ğŸ’Š **Cáº§n biáº¿t:**\\n` +\n      `â€¢ Danh sÃ¡ch táº¥t cáº£ thuá»‘c Ä‘ang dÃ¹ng\\n` +\n      `â€¢ Thá»±c pháº©m chá»©c nÄƒng, vitamin\\n` +\n      `â€¢ TÃ¬nh tráº¡ng bá»‡nh lÃ½\\n\\n` +\n      `ğŸ¥ **Khuyáº¿n nghá»‹:** Tham kháº£o dÆ°á»£c sÄ© hoáº·c bÃ¡c sÄ© Ä‘á»ƒ kiá»ƒm tra tÆ°Æ¡ng tÃ¡c thuá»‘c an toÃ n.`;\n    break;\n    \n  default:\n    response.message = `ğŸ‘‹ **ChÃ o má»«ng Ä‘áº¿n vá»›i Medical Chatbot!**\\n\\n` +\n      `ğŸ¥ TÃ´i cÃ³ thá»ƒ giÃºp báº¡n:\\n` +\n      `â€¢ TÆ° váº¥n thuá»‘c khÃ´ng cáº§n toa cho triá»‡u chá»©ng thÆ°á»ng gáº·p\\n` +\n      `â€¢ ThÃ´ng tin vá» tÃ¡c dá»¥ng phá»¥\\n` +\n      `â€¢ HÆ°á»›ng dáº«n sá»­ dá»¥ng thuá»‘c cÆ¡ báº£n\\n\\n` +\n      `ğŸ’¬ **VÃ­ dá»¥ cÃ¢u há»i:**\\n` +\n      `\\\"TÃ´i bá»‹ Ä‘au Ä‘áº§u, nÃªn uá»‘ng thuá»‘c gÃ¬?\\\"\\n` +\n      `\\\"Thuá»‘c paracetamol cÃ³ tÃ¡c dá»¥ng phá»¥ gÃ¬?\\\"\\n` +\n      `\\\"TÃ´i bá»‹ ho khan, cÃ³ thuá»‘c OTC nÃ o khÃ´ng?\\\"\\n\\n` +\n      `âš ï¸ **LÆ°u Ã½:** ÄÃ¢y chá»‰ lÃ  tÆ° váº¥n tham kháº£o, khÃ´ng thay tháº¿ Ã½ kiáº¿n bÃ¡c sÄ© chuyÃªn khoa.`;\n}\n\nreturn { json: response };"
      },
      "id": "6e2f7f8e-ef0e-9e7e-ff9e-8f1f2f3f4f5f",
      "name": "Handle General Inquiries",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1300, 350]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "7f3e8e9f-fe1f-af8f-ee0f-9f2f3f4f5f6f",
      "name": "Send Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1780, 250]
    }
  ],
  "pinData": {},
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Process User Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Chat Input": {
      "main": [
        [
          {
            "node": "Process User Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process User Input": {
      "main": [
        [
          {
            "node": "Route by Intent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Intent": {
      "main": [
        [
          {
            "node": "Search Medical Database",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Handle General Inquiries",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Medical Database": {
      "main": [
        [
          {
            "node": "Process Drug Recommendations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Drug Recommendations": {
      "main": [
        [
          {
            "node": "Send Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle General Inquiries": {
      "main": [
        [
          {
            "node": "Send Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1.0.0",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "medical-chatbot-workflow"
  },
  "id": "medical-chatbot-workflow",
  "tags": [
    {
      "createdAt": "2025-10-10T10:00:00.000Z",
      "updatedAt": "2025-10-10T10:00:00.000Z",
      "id": "medical-ai",
      "name": "Medical AI"
    }
  ]
}