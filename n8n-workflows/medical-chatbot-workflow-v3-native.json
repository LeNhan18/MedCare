{
  "name": "Medical Chatbot - Vietnamese",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "medical-chat",
        "responseMode": "onReceived",
        "options": {}
      },
      "id": "webhook-1",
      "name": "Webhook - Chat Input",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "medical-chat-webhook"
    },
    {
      "parameters": {
        "jsCode": "// Ph√°t hi·ªán tri·ªáu ch·ª©ng t·ª´ tin nh·∫Øn ti·∫øng Vi·ªát\nconst message = $input.first().json.message?.toLowerCase() || '';\nconst userId = $input.first().json.userId || 'anonymous';\nconst sessionId = $input.first().json.sessionId || Date.now().toString();\n\n// Dictionary tri·ªáu ch·ª©ng ti·∫øng Vi·ªát\nconst symptomKeywords = {\n  'ƒëau_ƒë·∫ßu': ['ƒëau ƒë·∫ßu', 'nh·ª©c ƒë·∫ßu', 'migraine', 'headache', 'ƒëau n·ª≠a ƒë·∫ßu'],\n  's·ªët': ['s·ªët', 'fever', 'n√≥ng ng∆∞·ªùi', '·ªëm', 'b·ªã s·ªët'],\n  'ho': ['ho', 'cough', 'ho khan', 'ho c√≥ ƒë·ªùm', 'ho nhi·ªÅu'],\n  'ƒëau_b·ª•ng': ['ƒëau b·ª•ng', 'stomach pain', 'ƒëau d·∫° d√†y', 'ƒëau t·ª•t'],\n  'c·∫£m_l·∫°nh': ['c·∫£m l·∫°nh', 'cold', 'flu', 'c√∫m', 'ngh·∫πt m≈©i'],\n  'm·ª•n_tr·ª©ng_c√°': ['m·ª•n', 'acne', 'm·ª•n tr·ª©ng c√°', 'da m·ª•n', 'm·ª•n m·ªß'],\n  'ti√™u_ch·∫£y': ['ti√™u ch·∫£y', 'diarrhea', 'ƒëi l·ªèng', 'ƒëi n∆∞·ªõc'],\n  't√°o_b√≥n': ['t√°o b√≥n', 'constipation', 'kh√≥ ƒëi ƒë·∫°i ti·ªán', 'ƒë·∫°i ti·ªán kh√≥'],\n  'vi√™m_h·ªçng': ['vi√™m h·ªçng', 'sore throat', 'ƒëau h·ªçng', 'h·ªçng ƒëau'],\n  'ch√≥ng_m·∫∑t': ['ch√≥ng m·∫∑t', 'dizzy', 'hoa m·∫Øt', 'ƒë·∫ßu quay'],\n  'ƒëau_rƒÉng': ['ƒëau rƒÉng', 'toothache', 'nh·ª©c rƒÉng', 'rƒÉng ƒëau'],\n  'm·∫•t_ng·ªß': ['m·∫•t ng·ªß', 'insomnia', 'kh√¥ng ng·ªß ƒë∆∞·ª£c', 'kh√≥ ng·ªß'],\n  'stress': ['stress', 'cƒÉng th·∫≥ng', 'lo √¢u', 'anxiety'],\n  'ƒëau_l∆∞ng': ['ƒëau l∆∞ng', 'back pain', 'l∆∞ng ƒëau', 'nh·ª©c l∆∞ng']\n};\n\n// Ph√°t hi·ªán tri·ªáu ch·ª©ng\nlet detectedSymptoms = [];\nfor (let symptom in symptomKeywords) {\n  for (let keyword of symptomKeywords[symptom]) {\n    if (message.includes(keyword)) {\n      detectedSymptoms.push(symptom);\n      break;\n    }\n  }\n}\n\n// X√°c ƒë·ªãnh ƒë·ªô n·∫∑ng d·ª±a tr√™n t·ª´ kh√≥a\nlet severity = 'mild';\nif (message.includes('r·∫•t') || message.includes('nhi·ªÅu') || message.includes('n·∫∑ng') || message.includes('kh·ªßng khi·∫øp')) {\n  severity = 'severe';\n} else if (message.includes('h∆°i') || message.includes('nh·∫π') || message.includes('√≠t')) {\n  severity = 'mild';\n} else {\n  severity = 'moderate';\n}\n\n// Lo·∫°i b·ªè duplicate symptoms\ndetectedSymptoms = [...new Set(detectedSymptoms)];\n\nreturn {\n  json: {\n    originalMessage: $input.first().json.message,\n    detectedSymptoms: detectedSymptoms,\n    severity: severity,\n    userId: userId,\n    sessionId: sessionId,\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "code-symptom-detection",
      "name": "Symptom Detection",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "jsCode": "// Load medical dataset - Embed data tr·ª±c ti·∫øp\nconst medicalDataSample = [\n  {\n    \"drug_name\": \"Paracetamol\",\n    \"medical_condition\": \"Pain\",\n    \"medical_condition_vi\": \"ƒëau ƒë·∫ßu\",\n    \"side_effects_vi\": \"bu·ªìn n√¥n, ch√≥ng m·∫∑t\",\n    \"drug_classes_vi\": \"thu·ªëc gi·∫£m ƒëau\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 8.5\n  },\n  {\n    \"drug_name\": \"Aspirin\",\n    \"medical_condition\": \"Headache\", \n    \"medical_condition_vi\": \"ƒëau ƒë·∫ßu\",\n    \"side_effects_vi\": \"ƒëau d·∫° d√†y\",\n    \"drug_classes_vi\": \"thu·ªëc ch·ªëng vi√™m\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 7.8\n  },\n  {\n    \"drug_name\": \"Ibuprofen\",\n    \"medical_condition\": \"Pain\",\n    \"medical_condition_vi\": \"ƒëau ƒë·∫ßu\",\n    \"side_effects_vi\": \"bu·ªìn n√¥n\",\n    \"drug_classes_vi\": \"thu·ªëc gi·∫£m ƒëau\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 8.2\n  },\n  {\n    \"drug_name\": \"Cough Syrup\",\n    \"medical_condition\": \"Cough\",\n    \"medical_condition_vi\": \"ho\",\n    \"side_effects_vi\": \"bu·ªìn ng·ªß\",\n    \"drug_classes_vi\": \"thu·ªëc ho\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 7.5\n  },\n  {\n    \"drug_name\": \"Fever Reducer\",\n    \"medical_condition\": \"Fever\",\n    \"medical_condition_vi\": \"s·ªët\",\n    \"side_effects_vi\": \"ch√≥ng m·∫∑t\",\n    \"drug_classes_vi\": \"thu·ªëc h·∫° s·ªët\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 8.0\n  },\n  {\n    \"drug_name\": \"Antacid\",\n    \"medical_condition\": \"Stomach Pain\",\n    \"medical_condition_vi\": \"ƒëau b·ª•ng\",\n    \"side_effects_vi\": \"t√°o b√≥n\",\n    \"drug_classes_vi\": \"thu·ªëc d·∫° d√†y\",\n    \"rx_otc\": \"OTC\",\n    \"rating\": 7.3\n  }\n];\n\n// L·∫•y data t·ª´ node tr∆∞·ªõc\nconst symptoms = $input.first().json.detectedSymptoms;\nconst severity = $input.first().json.severity;\n\n// TODO: Thay th·∫ø medicalDataSample b·∫±ng full dataset\n// C√≥ th·ªÉ load t·ª´ HTTP Request node ho·∫∑c embed full JSON\nconst medicalData = medicalDataSample;\n\nlet foundDrugs = [];\n\n// T√¨m ki·∫øm thu·ªëc cho t·ª´ng tri·ªáu ch·ª©ng\nfor (let symptom of symptoms) {\n  const symptomSearch = symptom.replace('_', ' ');\n  \n  const matchingDrugs = medicalData.filter(drug => {\n    const condition = (drug.medical_condition_vi || '').toLowerCase();\n    const conditionEn = (drug.medical_condition || '').toLowerCase();\n    \n    return condition.includes(symptomSearch) || \n           conditionEn.includes(symptomSearch) ||\n           condition.includes(symptom.replace('_', ''));\n  });\n  \n  foundDrugs.push(...matchingDrugs);\n}\n\n// S·∫Øp x·∫øp theo rating v√† ∆∞u ti√™n OTC cho severity nh·∫π\nfoundDrugs.sort((a, b) => {\n  // ∆Øu ti√™n OTC cho tri·ªáu ch·ª©ng nh·∫π\n  if (severity === 'mild') {\n    if (a.rx_otc === 'OTC' && b.rx_otc !== 'OTC') return -1;\n    if (b.rx_otc === 'OTC' && a.rx_otc !== 'OTC') return 1;\n  }\n  // S·∫Øp x·∫øp theo rating\n  return (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0);\n});\n\n// Lo·∫°i b·ªè duplicate d·ª±a tr√™n drug_name\nconst uniqueDrugs = foundDrugs.filter((drug, index, self) => \n  index === self.findIndex(d => d.drug_name === drug.drug_name)\n);\n\nreturn {\n  json: {\n    symptoms: symptoms,\n    severity: severity,\n    recommendedDrugs: uniqueDrugs.slice(0, 5), // Top 5 recommendations\n    totalFound: uniqueDrugs.length,\n    userId: $input.first().json.userId,\n    sessionId: $input.first().json.sessionId,\n    searchTimestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "code-drug-search",
      "name": "Drug Search Engine",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "jsCode": "// T·∫°o ph·∫£n h·ªìi th√¢n thi·ªán b·∫±ng ti·∫øng Vi·ªát\nconst symptoms = $input.first().json.symptoms || [];\nconst drugs = $input.first().json.recommendedDrugs || [];\nconst severity = $input.first().json.severity;\nconst originalMessage = $input.first().json.originalMessage || '';\n\nlet response = \"\";\nlet responseType = \"\";\n\nif (symptoms.length === 0) {\n  responseType = \"no_symptoms\";\n  response = `Xin ch√†o! T√¥i kh√¥ng th·ªÉ x√°c ƒë·ªãnh tri·ªáu ch·ª©ng c·ª• th·ªÉ t·ª´ tin nh·∫Øn: \"${originalMessage}\".\\n\\n`;\n  response += `B·∫°n c√≥ th·ªÉ m√¥ t·∫£ r√µ h∆°n tri·ªáu ch·ª©ng c·ªßa m√¨nh kh√¥ng? V√≠ d·ª•:\\n`;\n  response += `‚Ä¢ \"T√¥i b·ªã ƒëau ƒë·∫ßu\"\\n`;\n  response += `‚Ä¢ \"T√¥i b·ªã s·ªët v√† ho\"\\n`;\n  response += `‚Ä¢ \"T√¥i b·ªã ƒëau b·ª•ng\"\\n\\n`;\n  response += `T√¥i c√≥ th·ªÉ gi√∫p t∆∞ v·∫•n thu·ªëc cho c√°c tri·ªáu ch·ª©ng ph·ªï bi·∫øn! üòä`;\n} else if (drugs.length === 0) {\n  responseType = \"no_drugs\";\n  const symptomText = symptoms.map(s => s.replace(/_/g, ' ')).join(', ');\n  response = `T√¥i ƒë√£ hi·ªÉu b·∫°n c√≥ tri·ªáu ch·ª©ng: **${symptomText}**.\\n\\n`;\n  response += `Tuy nhi√™n, t√¥i kh√¥ng t√¨m th·∫•y thu·ªëc ph√π h·ª£p trong c∆° s·ªü d·ªØ li·ªáu hi·ªán t·∫°i.\\n\\n`;\n  response += `üè• **G·ª£i √Ω:**\\n`;\n  response += `‚Ä¢ ThƒÉm kh√°m b√°c sƒ© ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n ch√≠nh x√°c\\n`;\n  response += `‚Ä¢ Li√™n h·ªá d∆∞·ª£c sƒ© t·∫°i nh√† thu·ªëc g·∫ßn nh·∫•t\\n`;\n  response += `‚Ä¢ G·ªçi hotline y t·∫ø: 19003116`;\n} else {\n  responseType = \"recommendations\";\n  const symptomText = symptoms.map(s => s.replace(/_/g, ' ')).join(', ');\n  const severityText = severity === 'mild' ? 'nh·∫π' : severity === 'severe' ? 'n·∫∑ng' : 'v·ª´a ph·∫£i';\n  \n  response = `D·ª±a tr√™n tri·ªáu ch·ª©ng **\"${symptomText}\"** (m·ª©c ƒë·ªô: ${severityText}), t√¥i g·ª£i √Ω c√°c thu·ªëc sau:\\n\\n`;\n  \n  drugs.forEach((drug, index) => {\n    response += `**${index + 1}. ${drug.drug_name}** `;\n    response += `${drug.rx_otc === 'OTC' ? 'üü¢' : 'üî¥'} ${drug.rx_otc}\\n`;\n    \n    if (drug.medical_condition_vi) {\n      response += `   üìã D√πng cho: ${drug.medical_condition_vi}\\n`;\n    }\n    \n    if (drug.drug_classes_vi) {\n      response += `   üíä Lo·∫°i thu·ªëc: ${drug.drug_classes_vi}\\n`;\n    }\n    \n    if (drug.rating) {\n      const stars = '‚≠ê'.repeat(Math.round(parseFloat(drug.rating) / 2));\n      response += `   ${stars} ƒê√°nh gi√°: ${drug.rating}/10\\n`;\n    }\n    \n    if (drug.side_effects_vi) {\n      response += `   ‚ö†Ô∏è T√°c d·ª•ng ph·ª•: ${drug.side_effects_vi}\\n`;\n    }\n    \n    response += `\\n`;\n  });\n  \n  response += `\\nüõ°Ô∏è **L∆∞U √ù QUAN TR·ªåNG:**\\n`;\n  response += `‚Ä¢ üü¢ OTC: Kh√¥ng c·∫ßn toa b√°c sƒ©\\n`;\n  response += `‚Ä¢ üî¥ Rx: C·∫ßn c√≥ toa b√°c sƒ©\\n`;\n  response += `‚Ä¢ Th√¥ng tin n√†y ch·ªâ mang t√≠nh ch·∫•t tham kh·∫£o\\n`;\n  response += `‚Ä¢ Tham kh·∫£o √Ω ki·∫øn b√°c sƒ©/d∆∞·ª£c sƒ© tr∆∞·ªõc khi s·ª≠ d·ª•ng\\n`;\n  response += `‚Ä¢ ƒê·ªçc k·ªπ h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng\\n`;\n  response += `‚Ä¢ Ng∆∞ng s·ª≠ d·ª•ng n·∫øu c√≥ ph·∫£n ·ª©ng b·∫•t th∆∞·ªùng\\n\\n`;\n  \n  if (severity === 'severe') {\n    response += `üö® **C·∫¢NH B√ÅO**: Tri·ªáu ch·ª©ng n·∫∑ng - N√™n thƒÉm kh√°m b√°c sƒ© ngay!`;\n  }\n}\n\nreturn {\n  json: {\n    response: response,\n    responseType: responseType,\n    metadata: {\n      symptoms: symptoms,\n      symptomsCount: symptoms.length,\n      drugsFound: drugs.length,\n      severity: severity,\n      originalMessage: originalMessage,\n      timestamp: new Date().toISOString(),\n      language: 'vi'\n    },\n    userId: $input.first().json.userId,\n    sessionId: $input.first().json.sessionId\n  }\n};"
      },
      "id": "code-response-generator", 
      "name": "Response Generator",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"success\": true,\n  \"message\": \"{{ $json.response }}\",\n  \"metadata\": {\n    \"symptoms\": {{ $json.metadata.symptoms }},\n    \"drugsFound\": {{ $json.metadata.drugsFound }},\n    \"severity\": \"{{ $json.metadata.severity }}\",\n    \"responseType\": \"{{ $json.responseType }}\",\n    \"timestamp\": \"{{ $json.metadata.timestamp }}\"\n  },\n  \"userId\": \"{{ $json.userId }}\",\n  \"sessionId\": \"{{ $json.sessionId }}\"\n}",
        "options": {
          "headers": {
            "Content-Type": "application/json; charset=utf-8"
          }
        }
      },\n\
    {,"id\": \"webhook-response\",\n      \"name\": \"Webhook Response\",\n      \"type\": \"n8n-nodes-base.webhookResponse\",\n      \"typeVersion\": 1,\n      \"position\": [1120, 300]\n    },\n    {\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"jsonOutput\": \"[\\n  {\\n    \\\"drug_name\\\": \\\"Paracetamol\\\",\\n    \\\"medical_condition\\\": \\\"Pain\\\",\\n    \\\"medical_condition_vi\\\": \\\"ƒëau ƒë·∫ßu\\\",\\n    \\\"side_effects_vi\\\": \\\"bu·ªìn n√¥n, ch√≥ng m·∫∑t\\\",\\n    \\\"drug_classes_vi\\\": \\\"thu·ªëc gi·∫£m ƒëau\\\",\\n    \\\"rx_otc\\\": \\\"OTC\\\",\\n    \\\"rating\\\": 8.5\\n  },\\n  {\\n    \\\"drug_name\\\": \\\"Aspirin\\\",\\n    \\\"medical_condition\\\": \\\"Headache\\\", \\n    \\\"medical_condition_vi\\\": \\\"ƒëau ƒë·∫ßu\\\",\\n    \\\"side_effects_vi\\\": \\\"ƒëau d·∫° d√†y\\\",\\n    \\\"drug_classes_vi\\\": \\\"thu·ªëc ch·ªëng vi√™m\\\",\\n    \\\"rx_otc\\\": \\\"OTC\\\",\\n    \\\"rating\\\": 7.8\\n  }\\n]\",\n        \"options\": {}\n      },\n      \"id\": \"set-medical-data\",\n      \"name\": \"Medical Dataset\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.3,\n      \"position\": [680, 480],\n      \"disabled\": true\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Log ƒë·ªÉ debug v√† monitoring\\nconst inputData = $input.first().json;\\n\\nconsole.log('=== MEDICAL CHATBOT LOG ===');\\nconsole.log('Timestamp:', new Date().toISOString());\\nconsole.log('User ID:', inputData.userId);\\nconsole.log('Session ID:', inputData.sessionId);\\nconsole.log('Original Message:', inputData.originalMessage);\\nconsole.log('Detected Symptoms:', inputData.symptoms);\\nconsole.log('Severity:', inputData.severity);\\nconsole.log('Drugs Found:', inputData.metadata?.drugsFound || 0);\\nconsole.log('Response Type:', inputData.responseType);\\nconsole.log('============================');\\n\\n// C√≥ th·ªÉ g·ª≠i log l√™n external service n·∫øu c·∫ßn\\n// ho·∫∑c l∆∞u v√†o database ƒë·ªÉ analytics\\n\\nreturn $input.all();\"\n      },\n      \"id\": \"code-logger\",\n      \"name\": \"Debug Logger\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [900, 480]\n    }\n  ],\n  \"connections\": {\n    \"Webhook - Chat Input\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Symptom Detection\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Symptom Detection\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Drug Search Engine\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Drug Search Engine\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Response Generator\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Response Generator\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Webhook Response\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Debug Logger\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  },\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"staticData\": null,\n  \"tags\": [\n    {\n      \"createdAt\": \"2025-10-10T10:00:00.000Z\",\n      \"updatedAt\": \"2025-10-10T10:00:00.000Z\",\n      \"id\": \"1\",\n      \"name\": \"medical\"\n    },\n    {\n      \"createdAt\": \"2025-10-10T10:00:00.000Z\",\n      \"updatedAt\": \"2025-10-10T10:00:00.000Z\",\n      \"id\": \"2\",\n      \"name\": \"vietnamese\"\n    }\n  ],\n  \"triggerCount\": 1,\n  \"updatedAt\": \"2025-10-10T10:00:00.000Z\",\n  \"versionId\": \"v3-medical-vietnamese\"\n}